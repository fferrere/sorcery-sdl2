(in-package :sorcery-sdl2)

;; -------------
;; -- Sprites --
;; -------------

(defvar *sheet-sprites-indexes*
  '((AMPHORA :front (0)) (AXE :front (1)) (COATOFARMS :front (2)) (GOLDKEY :front (3))
    (FLAIL :front (4)) (FLEURDELYS :front (5)) (GOBLET :front (6)) (GOLDENCHALICE :front (7))
    (JEWELLEDCROWN :front (8)) (LITTLELYRE :front (9)) (MAGICWAND :front (10)) (MOON :front (11))
    (SPELLBAG :front (12)) (SPELLBOOK :front (13)) (SCROLL :front (14)) (SWORD :front (15))
    (SHOOTINGSTAR :front (16)) (CAULDRON :front (17 18) :stencil (19))
    (DOOR-LEFT :front (20 21 22 23)) (DOOR-RIGHT :front (24 25 26 27)) (BLAST :front (28 29 30 31))
    (EYE :front (32 33 34 35)) (APPRENTICE :front (36 37 38 39)) (WHEEL-OF-LIGHT :front (40 41 45 43))
    (GHOST :left (44 45 46 47) :front (48 49 50 51) :right (52 53 54 55)) (HEAD :front (56 57 58 59))
    (SORCERER :left (60 61 62 63) :front (64 65 66 67) :right (68 69 70 71))
    (MAGUS :left (72 73 74 75) :front (76 77 78) :right (79 80 81 82))
    (WILDBOAR :front (83 84 85 86)) (SPLASH :front (87 88 89 90)) (DROWN :front (91 92))
    (DOOR-GREEN :front (93) :stencil (94)) (DOOR-TRAP :front (95) :stencil (96))
    (LIGHTNING :front (97)) (FIRE :front (98 99)) (TIMEBOOK :data (100 101 102 103 104 105))
    (WATERFALL :front (106 107 108 109)) (RIVER :front (110 111 112 113)) (BAG :data (114 115 116 117))))

(defun sprite-indexes (name key)
    (getf (cdr (assoc name *sheet-sprites-indexes*)) key nil))
;; --------------
;; -- Stencils --
;; --------------

(defvar *sheet-sprites-stencils-indexes*
  '(AMPHORA AXE COATOFARMS GOLDKEY FLAIL FLEURDELYS GOBLET GOLDENCHALICE JEWELLEDCROWN
    LITTLELYRE MAGICWAND MOON SPELLBAG SPELLBOOK SCROLL SWORD SHOOTINGSTAR CAULDRON
    DOOR-LEFT DOOR-RIGHT EYE APPRENTICE GHOST HEAD SORCERER MAGUS WILDBOAR DOOR-GREEN
    DOOR-TRAP LIGHTNING FIRE WATERFALL RIVER))

(defun stencil-sprite-indexes (name)
  (or (sprite-indexes name :stencil) (sprite-indexes name :front)))

(defvar *sheet-stencils-indexes*
  '((AMPHORA . 0) (AXE . 1) (COATOFARMS . 2) (GOLDKEY . 3) (FLAIL . 4)
    (FLEURDELYS . 5) (GOBLET . 6) (GOLDENCHALICE . 7) (JEWELLEDCROWN . 8)
    (LITTLELYRE . 9) (MAGICWAND . 10) (MOON . 11) (SPELLBAG . 12) (SPELLBOOK . 13)
    (SCROLL . 14) (SWORD . 15) (SHOOTINGSTAR . 16) (CAULDRON . 17)
    (DOOR-LEFT . 18) (DOOR-RIGHT . 19) (EYE . 20) (APPRENTICE . 21) (GHOST . 22)
    (HEAD . 23) (SORCERER . 24) (MAGUS . 25) (WILDBOAR . 26) (DOOR-GREEN . 27)
    (DOOR-TRAP . 28) (LIGHTNING . 29) (FIRE . 30) (WATERFALL . 31) (RIVER . 32)))

(defun sheet-stencil-index (name)
  (cdr (assoc name *sheet-stencils-indexes*)))


(defun create-stencils-file (sprites-filename stencils-filename)
  (let ((width +element-width+)
        (height +element-height+)
        (list-of-indexes (mapcar #'(lambda (name)
                                     (stencil-sprite-indexes name))
                                 *sheet-sprites-stencils-indexes*)))
   (s2e:create-stencils sprites-filename list-of-indexes width height stencils-filename)))

;; ---------------
;; -- Game Data --
;; ---------------

(defparameter *world-data*
  '((:id e1
     :location stonehenge
     :bg-tiles ((0 0 0) (1 40 0) (2 80 0)
		(3 0 48) (4 40 48) (5 80 48)
		(6 0 144) (7 40 144) (8 200 144)
		(9 240 144) (10 280 144) (11 320 144)
		(12 360 144) (13 400 144) (14 600 144)
		(15 0 192) (16 240 192) (17 280 192)
		(18 320 192) (19 360 192) (20 400 192)
		(21 600 192) (22 0 240) (23 40 240)
		(24 80 240) (25 120 240) (26 160 240)
		(27 200 240) (28 240 240) (29 280 240)
		(30 320 240) (31 360 240) (32 400 240)
		(33 440 240) (34 480 240) (35 520 240)
		(36 560 240) (37 600 240))
     :fg-tiles ()
     :elements ((ghost 48 224)
	        (axe 96 224)
	        (amphora 0 96)
	        (fire 408 208)
	        (fire 156 224)
	        (apprentice 16 16)
	        (door-right 592 224 :id e1f1 :target f1)
	        (door-green 64 16 :key moon)
	        ))
    (:id f1
     :location nearstonehenge
     :bg-tiles ((38 480 48) (39 520 48) (40 560 48) (41 600 48)
		(42 480 96) (43 520 96) (44 560 96) (45 600 96)
		(6 0 144) (7 40 144) (46 440 144) (47 480 144)
		(48 520 144) (49 560 144) (50 600 144) (51 0 192)
		(52 240 192) (53 440 192) (54 480 192) (55 520 192)
		(56 560 192) (57 600 192) (58 0 240) (59 40 240)
		(60 80 240) (61 120 240) (62 160 240) (63 200 240)
		(64 240 240) (65 280 240) (66 320 240) (67 360 240)
		(68 400 240) (69 440 240) (70 480 240) (71 520 240)
		(72 560 240) (73 600 240))
     :fg-tiles ()
     :elements ((wildboar 176 224)
	        (sword 282 192)
	        (flail 334 224)
	        (fire 232 144)
	        (fire 536 16)
	        (door-left 0 224 :id e1f1 :target e1)
	        (door-right 576 224 :id f1g1 :target g1)
	        (door-right 592 128 :id f1g2 :target g2)))


    (:id g1
     :location tunnelmouth
     :bg-tiles ((74 600 0) (75 360 48) (76 400 48) (77 440 48)
		(78 480 48) (79 520 48) (80 560 48) (81 600 48)
		(82 160 144) (83 200 144) (84 400 144) (85 440 144)
		(86 0 192) (87 600 192) (88 0 240) (89 40 240)
		(90 80 240) (91 120 240) (92 160 240) (93 200 240)
		(94 240 240) (95 280 240) (96 320 240) (97 360 240)
		(98 400 240) (99 440 240) (100 480 240) (101 520 240)
		(102 560 240) (103 600 240))
     :fg-tiles ((104 0 240) (105 40 240) (106 80 240) (107 120 240)
		(108 160 240) (109 200 240) (110 240 240) (111 280 240)
		(112 320 240) (113 360 240) (114 400 240)
		(115 480 240) (116 560 240))
     :elements ((fire 168 112)
	        (fire 424 112)
	        (magus 320 224)
	        (wildboar 96 40)
	        (amphora 416 0)
	        (goldkey 424 224)
	        (door-left 16 224 :id f1g1 :target f1)
	        (door-right 576 0 :id g1g2 :target g2)
	        (door-right 592 224 :id g1h1 :target h1)))
    (:id g2
     :location wastelands
     :bg-tiles (
		(117 40 0) (118 80 0) (119 120 0) (120 0 48)
		(121 40 48) (122 80 48) (123 120 48) (124 0 144)
		(50 40 144) (125 80 144) (126 120 144) (127 160 144)
		(128 200 144) (129 240 144) (130 280 144) (38 320 144)
		(131 360 144) (132 400 144) (46 440 144) (133 480 144)
		(134 520 144) (135 560 144) (136 600 144) (137 0 192)
		(138 40 192) (139 80 192) (140 120 192) (141 160 192)
		(142 200 192) (143 240 192) (144 280 192) (145 320 192)
		(146 360 192) (147 400 192) (148 440 192) (54 480 192)
		(149 520 192) (150 560 192) (151 600 192) (152 0 240)
		(153 40 240) (154 80 240) (155 320 240) (156 360 240)
		(157 400 240) (158 440 240) (159 480 240) (160 520 240)
		(161 560 240) (162 600 240)
		)
     :fg-tiles (
		(163 200 144) (164 520 144) (165 320 192) (166 360 192)
		(167 320 240) (168 360 240)
		)
     :elements ((magus 0 128)
	        (cauldron 480 128)
	        (amphora 80 128)
	        (spellbag 460 224)
	        (fire 248 128)
	        (fire 360 128)
	        (river 112 240 :size 7) ; 136
	        (door-trap 304 160 :key amphora)
	        (door-left 0 224 :id f1g2 :target f1)
	        (door-left 384 224 :id g1g2 :target g1)
	        (door-right 592 128 :id g2h2u :target h2)
	        (door-right 592 224 :id g2h2d :target h2)))

    (:id h1
     :location tunnelmouth
     :bg-tiles ((0 0 0) (169 40 0) (170 80 0) (171 120 0)
		(42 320 0) (172 360 0) (173 400 0) (174 440 0)
		(175 480 0) (176 360 48) (177 400 48) (178 440 48)
		(179 480 48) (180 520 48) (177 560 48) (181 600 48)
		(182 360 96) (183 400 96) (184 440 96) (185 480 96)
		(186 520 96) (187 560 96) (188 600 96) (189 0 144)
		(190 0 192) (191 40 192) (192 320 192) (193 360 192)
		(194 400 192) (195 440 192) (196 480 192) (197 520 192)
		(198 560 192) (199 600 192) (200 0 240) (201 40 240)
		(202 80 240) (203 120 240) (204 160 240) (205 200 240)
		(206 240 240) (207 280 240) (208 320 240) (209 360 240)
		(210 400 240) (178 440 240) (211 480 240) (212 520 240)
		(213 560 240) (214 600 240))
     :fg-tiles ((215 40 0) (216 360 0) 
		(217 440 0) (218 360 48) (218 440 48) (219 520 48)
		(220 560 48) (221 400 144) (222 320 192) (223 360 192)
		(224 400 192) (225 440 192) (226 480 192) (227 520 192)
		(228 320 240) (229 360 240) (230 400 240) (231 440 240)
		(232 480 240) (233 520 240))
     :elements ((wildboar 272 224)
	        (wildboar 420 224)
	        (goldkey 28 48)
	        (spellbag 516 224)
	        (door-left 16 224 :id g1h1 :target g1)
	        (door-right 592 32 :id h1i1u :target i1)
	        (door-right 592 224 :id h1i1d :target i1)))
    (:id h2
     :location wastelands
     :bg-tiles ((234 0 0) (235 0 48) (236 40 48) (237 80 48)
		(238 120 48) (239 240 96) (240 200 144)
		(241 240 144) (242 280 144) (243 320 144)
		(244 360 144) (245 400 144) (246 440 144)
		(72 480 144) (247 520 144) (248 560 144)
		(249 600 144) (250 160 192) (251 200 192)
		(252 240 192) (253 280 192) (254 320 192)
		(255 360 192) (256 400 192) (257 440 192)
		(258 480 192) (259 520 192) (150 560 192)
		(260 600 192) (261 0 240) (262 40 240) (263 80 240)
		(264 120 240) (265 160 240) (266 200 240)
		(267 240 240) (50 280 240) (124 320 240)
		(50 360 240) (243 400 240) (268 440 240)
		(127 480 240) (269 520 240) (270 560 240) (271 600 240))
     :fg-tiles ((272 320 144) (273 360 144) (274 520 144)
		(164 360 240) (275 440 240))
     :elements ((ghost 368 0)
	        (axe 432 224)
	        (sword 372 128)
	        (apprentice 16 0)
	        (door-green 64 0 :key goblet)
	        (door-left 0 224 :id g2h2u :target g2)
	        (door-left 208 224 :id g2h2d :target g2)
	        (door-right 592 112 :id h2i2u :target i2)
	        (door-right 592 224 :id h2i2d :target i2)))
    (:id i1
     :location tunnel
     :bg-tiles ((276 0 0) (277 40 0) (278 80 0) (171 120 0)
		(279 280 0) (280 320 0) (257 360 0) (175 400 0)
		(281 520 0) (282 560 0) (144 600 0) (283 0 48)
		(284 40 48) (285 80 48) (286 120 48) (287 160 48)
		(288 200 48) (289 240 48) (290 280 48) (291 320 48)
		(292 360 48) (293 400 48) (181 440 48) (98 480 48)
		(294 520 48) (98 560 48) (214 600 48) (295 0 96)
		(296 40 96) (297 80 96) (298 120 96) (299 160 96)
		(300 200 96) (301 240 96) (302 280 96) (303 320 96)
		(304 360 96) (305 400 96) (306 440 96) (307 480 96)
		(308 520 96) (309 560 96) (310 600 96) (311 440 144)
		(312 0 192) (313 400 192) (314 440 192) (315 480 192)
		(316 520 192) (317 560 192) (318 600 192) (283 0 240)
		(319 40 240) (320 80 240) (321 120 240) (322 160 240)
		(323 200 240) (177 240 240) (181 280 240) (324 320 240)
		(325 360 240) (326 400 240) (327 440 240) (328 480 240)
		(329 520 240) (330 560 240) (331 600 240))
     :fg-tiles ((332 80 0) (333 320 0) (334 560 0) (335 40 48)
		(336 80 48) (337 280 48) (338 320 48) (339 560 48)
		(340 320 240) (341 360 240))
     :elements ((WILDBOAR 538 112) (MAGUS 352 32) (GOLDKEY 312 32)
	        (GOBLET 532 224) (CAULDRON 288 224)
	        (DOOR-TRAP 208 64 :KEY AMPHORA)
	        (DOOR-GREEN 448 224 :KEY GOLDKEY)
	        (DOOR-LEFT 0 32 :ID H1I1U :TARGET H1)
	        (DOOR-LEFT 0 224 :ID H1I1D :TARGET H1)
	        (DOOR-RIGHT 592 32 :ID I1J1 :TARGET J1) (RIVER 472 144 :SIZE 5)
	        (WATERFALL 480 0 :WIDTH 2 :HEIGHT 5)))
    (:id i2
     :location wastelands
     :bg-tiles ((342 320 0) (343 360 0) (344 400 0) (345 320 48)
		(346 360 48) (347 400 48) (348 440 48) (349 600 96)
		(350 400 144) (351 440 144) (352 480 144)
		(353 520 144) (354 560 144) (355 600 144)
		(356 80 192) (357 120 192) (358 160 192)
		(359 200 192) (360 240 192) (361 280 192)
		(362 320 192) (363 360 192) (364 400 192)
		(55 440 192) (365 480 192) (366 520 192)
		(367 560 192) (1 600 192) (368 0 240) (369 40 240)
		(370 80 240) (371 120 240) (372 160 240)
		(373 200 240) (374 240 240) (375 320 240)
		(50 360 240) (49 400 240) (376 440 240)
		(377 480 240) (378 520 240) (379 560 240)
		(380 600 240))
     :fg-tiles ((381 400 0) (382 440 0) (383 280 144) (384 440 144)
		(385 320 240) (386 360 240) (387 400 240))
     :elements ((WILDBOAR 440 224) (EYE 288 8) (SHOOTINGSTAR 32 16)
	        (JEWELLEDCROWN 368 224) (DOOR-LEFT 0 208 :ID H2I2U :TARGET H2)
	        (DOOR-LEFT 240 240 :ID H2I2D :TARGET H2)
	        (DOOR-RIGHT 592 32 :ID I2J3 :TARGET J3)
	        (DOOR-RIGHT 592 224 :ID I2K2 :KEY COATOFARMS :TARGET K2)))
    (:id j1
     :location tunnel
     :bg-tiles ((0 0 0) (388 40 0) (389 80 0) (55 120 0)
		(390 160 0) (210 0 48) (284 40 48)
		(391 80 48) (392 480 48) (393 520 48)
		(394 560 48) (395 600 48) (396 0 96)
		(397 40 96) (398 80 96) (399 480 96)
		(400 520 96) (401 160 144) (402 200 144)
		(403 480 144) (404 520 144) (405 560 144)
		(406 600 144) (407 0 192) (408 40 192)
		(409 80 192) (410 160 192) (411 200 192)
		(412 560 192) (413 600 192) (414 0 240)
		(415 40 240) (416 80 240) (417 320 240)
		(418 360 240) (419 400 240) (420 440 240)
		(243 480 240) (421 520 240) (422 560 240)
		(423 600 240))
     :fg-tiles ((424 80 0) (425 40 48) (426 80 48) (427 560 96)
		(428 160 144))
     :elements ((MAGUS 396 224) (WILDBOAR 88 128) (MOON 576 96)
	        (COATOFARMS 32 208) (DOOR-TRAP 576 32 :KEY GOLDKEY)
	        (DOOR-LEFT 0 32 :ID I1J1 :TARGET I1)
	        (DOOR-RIGHT 592 224 :ID J1K1 :KEY COATOFARMS :TARGET K1)
	        (RIVER 0 240 :SIZE 10) (RIVER 0 144 :SIZE 6)
	        (WATERFALL 96 192 :WIDTH 3 :HEIGHT 5)))
    (:id j3
     :location outsidecastle
     :bg-tiles ((429 0 0) (430 40 0) (431 80 0) (432 120 0)
		(433 160 0) (434 560 48) (435 600 48)
		(436 0 96) (437 40 96) (438 560 96)
		(439 600 96) (440 0 144) (441 40 144)
		(442 80 144) (438 560 144) (443 600 144)
		(444 560 192) (445 600 192) (446 0 240)
		(447 40 240) (448 80 240) (449 120 240)
		(379 160 240) (450 200 240) (451 240 240)
		(452 280 240) (453 480 240) (454 520 240)
		(455 560 240) (456 600 240))
     :fg-tiles ((457 80 240) (458 120 240) (459 200 240))
     :elements ((MAGUS 224 224) (AXE 80 224) (SWORD 32 112)
	        (DOOR-LEFT 0 224 :ID I2J3 :TARGET I2)
	        (DOOR-RIGHT 592 32 :ID J3K3 :TARGET K3) (RIVER 320 240 :SIZE 5)))
    (:id k1
     :location strongroom
     :bg-tiles ((460 600 0) (461 0 48) (462 40 48) (463 80 48)
		(464 120 48) (465 160 48) (466 200 48) (467 240 48)
		(468 280 48) (465 320 48) (466 360 48) (469 400 48)
		(470 480 48) (466 520 48) (471 560 48) (472 600 48)
		(473 0 96) (474 240 96) (475 280 96) (476 320 96)
		(477 600 96) (478 0 144) (479 40 144) (480 80 144)
		(481 240 144) (482 480 144) (483 520 144) (484 560 144)
		(485 600 144) (486 0 192) (487 40 192) (488 80 192)
		(489 240 192) (490 280 192) (491 320 192) (492 480 192)
		(493 520 192) (494 560 192) (495 600 192) (496 0 240)
		(497 40 240) (422 80 240) (423 120 240) (498 160 240)
		(499 200 240) (500 240 240) (501 280 240) (502 320 240)
		(503 360 240) (504 400 240) (423 440 240) (505 480 240)
		(506 520 240) (422 560 240) (423 600 240))
     :fg-tiles ((507 0 0) (508 40 0) (509 80 48) (510 280 48)
		(511 520 48) (512 560 48) (513 600 48)
		(514 80 96) (515 280 96) (516 520 96)
		(517 560 96) (518 600 96) (519 80 144)
		(520 240 144) (521 280 144) (522 520 144)
		(523 0 192) (524 40 192) (525 560 192) (526 600 192))
     :elements ((MAGUS 268 224) (MAGUS 268 0) (APPRENTICE 272 144)
	        (AMPHORA 32 112)
	        (SPELLBAG 512 112) (DOOR-TRAP 432 16 :KEY GOLDKEY)
	        (DOOR-GREEN 312 144 :KEY JEWELLEDCROWN)
	        (DOOR-LEFT 0 0 :ID K2K1 :TARGET K2)
	        (DOOR-LEFT 0 224 :ID J1K1 :TARGET J1)
	        (DOOR-RIGHT 592 224 :ID K1L1 :TARGET L1)))
    (:id k2
     :location dungeon
     :bg-tiles ((527 0 0) (410 560 0) (528 600 0) (529 0 48)
		(530 40 48) (531 80 48) (532 120 48) (482 320 48)
		(533 360 48) (534 0 96) (535 40 96) (536 80 96)
		(537 120 96) (538 160 96) (539 200 96) (540 240 96)
		(541 280 96) (542 320 96) (543 360 96) (544 560 96)
		(545 600 96) (189 0 144) (546 240 144) (505 320 144)
		(547 360 144) (548 400 144) (549 440 144) (550 480 144)
		(551 520 144) (552 560 144) (553 600 144) (554 0 192)
		(555 40 192) (556 320 192) (557 360 192) (558 400 192)
		(559 440 192) (560 480 192) (561 520 192) (562 560 192)
		(563 600 192) (564 0 240) (506 40 240) (565 80 240)
		(566 120 240) (496 160 240) (567 200 240) (568 240 240)
		(569 280 240) (505 320 240) (570 360 240) (571 400 240)
		(475 440 240) (572 480 240) (501 520 240) (548 560 240)
		(573 600 240))
     :fg-tiles ((574 560 96) (575 600 96) (576 0 192)
		(577 40 192) (578 560 192) (579 600 192))
     :elements ((MAGUS 488 224) (MAGUS 488 128) (SWORD 592 64) (GOLDKEY 88 0)
	        (DOOR-TRAP 272 144 :KEY AMPHORA)
	        (DOOR-LEFT 32 224 :ID I2K2 :TARGET I2)
	        (DOOR-RIGHT 576 128 :ID K2L2 :TARGET L2)
	        (DOOR-RIGHT 592 224 :ID K2K1 :TARGET K1) (RIVER 0 48 :SIZE 11)))
    (:id k3
     :location castle
     :bg-tiles ((580 160 0) (581 200 0) (582 240 0)
		(583 280 0) (584 320 0) (585 360 0)
		(586 400 0) (587 440 0) (588 0 48)
		(589 40 48) (590 520 48) (591 560 48)
		(592 600 48) (593 0 96) (594 40 96)
		(595 520 96) (596 560 96) (592 600 96)
		(597 0 144) (598 40 144) (599 480 144)
		(600 520 144) (601 560 144) (602 600 144)
		(603 0 192) (604 40 192) (605 80 192)
		(460 440 192) (606 480 192) (607 520 192)
		(608 560 192) (609 600 192) (610 0 240)
		(611 40 240) (612 80 240) (613 120 240)
		(36 160 240) (614 200 240) (615 240 240)
		(616 280 240) (617 320 240) (618 360 240)
		(619 400 240) (620 440 240) (621 480 240)
		(622 520 240) (623 560 240) (624 600 240))
     :fg-tiles ()
     :elements ((FLAIL 320 208) (SPELLBAG 528 176) (MAGUS 280 224)
	        (HEAD 204 128) (CAULDRON 192 224)
	        (DOOR-GREEN 480 176 :KEY AMPHORA)
	        (DOOR-LEFT 0 32 :ID J3K3 :TARGET J3)
	        (DOOR-RIGHT 592 0 :ID K3L3 :TARGET L3)))
    (:id l1
     :location tunnel
     :bg-tiles ((625 600 0) (626 560 48) (627 600 48) (628 0 96)
		(629 40 96) (630 560 96) (631 0 144) (632 40 144)
		(633 80 144) (634 120 144) (635 560 144) (636 0 192)
		(637 40 192) (638 80 192) (639 120 192) (640 160 192)
		(641 240 192) (642 280 192) (189 320 192) (643 560 192)
		(644 600 192) (505 0 240) (423 40 240) (505 80 240)
		(497 120 240) (552 160 240) (497 200 240) (645 240 240)
		(646 280 240) (647 320 240) (648 360 240) (645 400 240)
		(547 440 240) (505 480 240) (497 520 240) (645 560 240)
		(547 600 240))
     :fg-tiles ((649 560 96) (521 600 96) (650 560 144) (521 600 144)
		(651 0 192) (652 40 192) (653 560 192) (654 600 192))
     :elements ((SWORD 16 64) (SPELLBOOK 560 16) (MAGUS 240 224) (MAGUS 396 224)
	        (CAULDRON 592 160) (DOOR-TRAP 192 160 :KEY COATOFARMS)
	        (DOOR-GREEN 544 128 :KEY GOLDKEY)
	        (DOOR-LEFT 0 224 :ID K1L1 :TARGET K1)
	        (DOOR-RIGHT 592 224 :ID L1M1 :TARGET M1)))
    (:id l2
     :location dungeon
     :bg-tiles ((655 560 0) (656 600 0) (657 0 48) (658 40 48)
		(659 80 48) (660 160 48) (661 200 48) (662 240 48)
		(663 280 48) (664 320 48) (665 360 48) (666 400 48)
		(667 440 48) (668 0 96) (669 400 96) (670 440 96)
		(671 480 96) (672 520 96) (671 560 96) (673 600 96)
		(82 0 144) (83 40 144) (674 480 144) (675 0 192)
		(676 40 192) (677 480 192) (678 520 192) (679 560 192)
		(680 600 192) (681 0 240) (567 40 240) (682 80 240)
		(475 120 240) (683 160 240) (503 200 240) (571 240 240)
		(475 280 240) (683 320 240) (503 360 240) (571 400 240)
		(475 440 240) (683 480 240) (503 520 240) (504 560 240)
		(423 600 240))
     :fg-tiles ((507 0 0) (508 40 0) (684 0 48) (685 40 48)
		(686 80 48) (687 160 48) (688 200 48) (689 240 48)
		(690 280 48) (691 360 48) (692 400 48) (693 0 96)
		(694 440 96) (695 480 96) (696 520 96) (697 560 96)
		(698 600 96) (699 480 144) (700 520 144) (701 560 144)
		(521 600 144) (702 0 192) (703 40 192)
		(704 480 192) (705 520 192) (706 560 192) (654 600 192))
     :elements ((GHOST 268 140) (AXE 592 160) (AMPHORA 208 224) (HEAD 268 8)
	        (CAULDRON 320 224) (FIRE 8 112) (APPRENTICE 512 160)
	        (DOOR-TRAP 112 48 :KEY GOLDKEY) (DOOR-GREEN 464 128 :KEY SCROLL)
	        (DOOR-LEFT 0 0 :ID L3L2 :TARGET L3)
	        (DOOR-LEFT 32 224 :ID K2L2 :TARGET K2)
	        (DOOR-RIGHT 592 224 :ID L2M3 :TARGET M3) (RIVER 448 64 :SIZE 6)))
    (:id l3
     :location castle
     :bg-tiles ((707 0 48) (708 40 48) (709 560 48)
		(710 600 48) (711 0 96) (712 40 96)
		(713 560 96) (714 600 96) (715 0 144)
		(716 40 144) (717 520 144) (718 560 144)
		(719 600 144) (720 0 192) (721 40 192)
		(189 80 192) (722 480 192) (723 520 192)
		(718 560 192) (724 600 192) (725 0 240)
		(726 40 240) (727 80 240) (728 120 240)
		(729 160 240) (730 200 240) (731 240 240)
		(732 280 240) (733 320 240) (734 360 240)
		(735 400 240) (736 440 240) (737 480 240)
		(738 520 240) (739 560 240) (740 600 240))
     :fg-tiles ((741 0 144) (742 40 144) (743 480 192)
		(744 120 240) (745 240 240))
     :elements ((GHOST 276 96) (SCROLL 176 208) (COATOFARMS 432 208)
	        (DOOR-LEFT 0 16 :ID K3L3 :TARGET K3)
	        (DOOR-LEFT 16 160 :ID L3L2 :KEY COATOFARMS :TARGET L2)
	        (DOOR-RIGHT 592 16 :ID L3M3 :TARGET M3)))
    (:id m1
     :location tunnel
     :bg-tiles ((746 0 0) (747 40 0) (748 0 48)
		(749 160 48) (750 200 48) (751 240 48)
		(752 280 48) (753 400 48) (754 440 48)
		(755 0 96) (756 40 96) (757 440 96)
		(758 600 144) (759 0 192) (760 40 192)
		(761 80 192) (762 120 192) (763 560 192)
		(764 600 192) (765 0 240) (766 40 240)
		(767 80 240) (768 120 240) (769 160 240)
		(770 200 240) (771 240 240) (772 280 240)
		(773 320 240) (774 360 240) (775 400 240)
		(667 440 240) (776 560 240) (777 600 240))
     :fg-tiles ((778 200 0) (779 240 0) (780 200 48)
		(781 240 48) (782 280 48) (783 40 96)
		(784 0 144) (508 40 144) (785 40 192)
		(786 560 192) (787 600 192))
     :elements ((GHOST 312 0) (JEWELLEDCROWN 260 16) (COATOFARMS 48 224)
	        (MAGUS 312 224) (FIRE 424 32) (DOOR-TRAP 64 160 :KEY GOLDKEY)
	        (DOOR-LEFT 0 144 :ID L1M1 :TARGET L1)
	        (DOOR-RIGHT 592 208 :ID M1N1 :TARGET N1)
	        (RIVER 448 240 :SIZE 6)))
    (:id m3
     :location outsidecastle
     :bg-tiles ((593 0 48) (788 40 48) (789 80 48)
		(790 120 48) (593 0 96) (791 40 96)
		(792 80 96) (793 120 96) (794 160 96)
		(593 0 144) (795 40 144) (796 80 144)
		(593 0 192) (797 40 192) (798 80 192)
		(799 120 192) (800 160 192) (801 200 192)
		(802 240 192) (803 0 240) (804 40 240)
		(805 80 240) (806 120 240) (807 160 240)
		(808 200 240) (809 240 240) (810 280 240)
		(811 320 240) (812 360 240) (60 400 240)
		(813 440 240) (814 480 240) (815 520 240)
		(379 560 240) (813 600 240))
     :fg-tiles ((816 120 48) (817 80 144) (818 120 144))
     :elements ((MAGUS 470 224) (EYE 470 32) (AMPHORA 256 192) (GOLDKEY 376 224)
	        (DOOR-LEFT 0 0 :ID L3M3 :TARGET L3)
	        (DOOR-LEFT 112 144 :ID L2M3 :KEY COATOFARMS :TARGET L2)
	        (DOOR-RIGHT 592 0 :ID M3N6 :TARGET N6)
	        (DOOR-RIGHT 592 224 :ID M3N3 :TARGET N3)))
    (:id m6
     :location sanctuary
     :bg-tiles ((819 600 0) (820 560 48) (821 600 48)
		(822 240 96) (823 280 96) (824 320 96)
		(825 160 144) (826 200 144) (827 240 144)
		(828 280 144) (829 320 144) (826 360 144)
		(827 400 144) (830 40 192) (831 80 192)
		(832 120 192) (833 160 192) (834 200 192)
		(835 240 192) (828 280 192) (835 320 192)
		(828 360 192) (836 400 192) (837 440 192)
		(838 480 192) (839 520 192) (840 0 240)
		(841 40 240) (842 80 240) (843 120 240)
		(844 160 240) (845 200 240) (846 240 240)
		(847 280 240) (848 320 240) (849 360 240)
		(850 400 240) (851 440 240) (852 480 240)
		(853 520 240) (854 560 240) (855 600 240))
     :fg-tiles ()
     ;;:elements ((PEDESTAL 288 100) (DOOR-RIGHT 592 0 :ID M6N6 :TARGET N6))
     :elements ( (DOOR-RIGHT 592 0 :ID M6N6 :TARGET N6))
     )

    (:id n1
     :location tunnel
     :bg-tiles ((856 200 48) (505 240 48) (547 280 48)
		(505 320 48) (857 360 48) (858 0 96)
		(667 40 96) (84 80 96) (85 120 96)
		(859 200 96) (860 240 96) (861 480 96)
		(862 0 144) (863 40 144) (864 200 144)
		(865 240 144) (866 280 144) (867 320 144)
		(868 360 144) (869 0 192) (870 40 192)
		(401 160 192) (402 200 192) (871 600 192)
		(872 0 240) (873 40 240) (874 80 240)
		(875 160 240) (876 200 240) (401 320 240)
		(877 360 240) (878 400 240) (879 440 240)
		(880 480 240) (881 520 240) (882 560 240)
		(883 600 240))
     :fg-tiles ((884 280 0) (885 240 48) (886 280 48)
		(887 360 48) (888 240 96) (700 280 96)
		(701 320 96) (889 360 96) (890 0 144)
		(891 40 144) (892 240 144) (893 280 144)
		(894 320 144) (895 360 144))
     :elements ((GHOST 196 0) (SWORD 212 208) (AMPHORA 324 32) (MAGUS 400 224)
	        (FIRE 104 64) (FIRE 472 64) (APPRENTICE 288 112)
	        (DOOR-GREEN 352 96 :KEY MAGICWAND)
	        (DOOR-LEFT 0 160 :ID M1N1 :TARGET M1)
	        (DOOR-RIGHT 592 208 :ID N1O1 :TARGET O1) (RIVER 0 192 :SIZE 6)
	        (RIVER 96 240 :SIZE 8) (WATERFALL 96 240 :WIDTH 3 :HEIGHT 2)))
    (:id n3
     :location waterfall
     :bg-tiles ((896 0 0) (897 40 0) (898 80 0)
		(899 560 0) (900 600 0) (901 160 48)
		(902 200 48) (903 560 48) (904 600 48)
		(905 80 96) (906 120 96) (907 160 96)
		(908 200 96) (909 240 96) (910 280 96)
		(911 360 96) (912 400 96))
     :fg-tiles ()
     :elements ((LITTLELYRE 376 48) (FLAIL 128 48) (GHOST 312 16) (EYE 312 192)
	        (DOOR-LEFT 0 208 :ID M3N3 :TARGET M3)
	        (DOOR-LEFT 0 32 :ID N3N5L :TARGET N5)
	        (DOOR-RIGHT 544 16 :ID N3N5R :TARGET N5)
	        (DOOR-RIGHT 592 208 :ID N3O3 :TARGET O3) (RIVER 0 240 :SIZE 10)
	        (RIVER 288 64 :SIZE 3) (RIVER 384 240 :SIZE 8)
	        (WATERFALL 224 0 :WIDTH 2 :HEIGHT 7)
	        (WATERFALL 320 112 :WIDTH 2 :HEIGHT 11)))
    (:id n5
     :location waterfall
     :bg-tiles ((913 440 0) (914 480 0) (915 0 48)
		(913 440 48) (914 480 48) (916 560 48)
		(917 600 48) (918 0 96) (919 40 96)
		(920 400 96) (921 440 96) (922 480 96)
		(923 520 96) (924 0 144) (925 40 144)
		(926 360 144) (927 400 144) (928 440 144)
		(929 480 144) (930 520 144) (931 120 192)
		(932 160 192) (933 200 192) (934 280 192)
		(935 320 192) (936 360 192) (937 0 240)
		(938 40 240) (939 280 240) (940 320 240)
		(941 360 240) (942 480 240) (943 520 240)
		(944 560 240) (945 600 240))
     :fg-tiles ((946 40 144) (947 320 144) (948 120 192)
		(949 320 192))
     :elements ((AMPHORA 160 144) (GOLDKEY 332 176) (GHOST 328 16) (HEAD 128 16)
	        (DOOR-LEFT 0 0 :ID N5N6 :TARGET N6)
	        (DOOR-LEFT 0 224 :ID N3N5L :TARGET N3)
	        (DOOR-RIGHT 592 0 :ID N5O5 :TARGET O5)
	        (DOOR-RIGHT 592 224 :ID N3N5R :TARGET N3)
	        (WATERFALL 224 0 :WIDTH 2 :HEIGHT 18)))
    (:id n6
     :location nearpalace
     :bg-tiles ((950 40 0) (951 80 0) (952 40 48)
		(953 80 48) (954 280 48) (955 0 96)
		(956 40 96) (957 80 96) (958 120 96)
		(959 160 96) (960 200 96) (961 280 96)
		(962 400 144) (963 440 144) (964 480 144)
		(965 520 144) (966 560 144) (967 440 192)
		(833 480 192) (968 520 192) (969 200 240)
		(970 280 240))
     :fg-tiles ((971 440 240) (972 480 240))
     :elements ((SHOOTINGSTAR 96 108) (SPELLBAG 480 128)
	        (DOOR-LEFT 96 0 :ID M6N6 :TARGET M6)
	        (DOOR-LEFT 0 240 :ID N5N6 :TARGET N5)
	        (DOOR-RIGHT 592 0 :ID N6O6 :TARGET O6)
	        (DOOR-RIGHT 464 240 :ID M3N6 :TARGET M3) (RIVER 64 48 :SIZE 7)
	        (WATERFALL 0 0 :WIDTH 2 :HEIGHT 6)
	        (WATERFALL 224 96 :WIDTH 2 :HEIGHT 12)))
    (:id o1
     :location tunnel
     :bg-tiles ((973 560 48) (974 600 48) (975 120 96) (976 440 96)
		(977 480 96) (978 120 192) (979 160 192) (980 200 192)
		(981 240 192) (982 280 192) (983 0 240) (984 40 240)
		(985 80 240) (986 120 240) (987 160 240) (988 200 240)
		(989 240 240) (990 280 240) (401 560 240) (991 600 240))
     :fg-tiles ((871 600 192) (992 80 240) (993 160 240) (994 200 240))
     :elements ((GOLDKEY 196 224) (FLAIL 592 0) (FIRE 120 48) (FIRE 456 48)
	        (CAULDRON 208 144) (EYE 376 224) (GHOST 208 0)
	        (DOOR-GREEN 240 208 :KEY AMPHORA)
	        (DOOR-LEFT 0 192 :ID N1O1 :TARGET N1)
	        (DOOR-RIGHT 592 208 :ID O1P1 :TARGET P1) (RIVER 304 240 :SIZE 9)))
    (:id o3
     :location nearcastle
     :bg-tiles ((939 120 0) (995 160 0) (996 200 0)
		(997 240 0) (998 400 0) (999 440 0)
		(1000 480 0) (1001 520 0) (1002 560 0)
		(1003 600 0) (1004 320 48) (1005 360 48)
		(1006 400 48) (587 440 48) (1007 560 48)
		(1008 600 48) (1009 520 96) (1010 560 96)
		(1011 600 96) (1012 520 144) (1013 560 144)
		(1014 600 144) (1015 560 192) (1016 600 192)
		(1017 120 240) (1018 160 240) (1019 200 240)
		(1020 240 240) (1021 280 240) (1022 320 240)
		(1023 360 240) (26 400 240) (1021 440 240)
		(1024 480 240) (1025 520 240) (1026 560 240)
		(1027 600 240))
     :fg-tiles ((1028 320 0) (1029 360 0) (1030 560 192)
		(1031 600 192) (1032 160 240) (1033 320 240))
     :elements ((FLEURDELYS 352 224) (GOLDKEY 488 224) (MAGUS 256 224)
	        (WILDBOAR 256 128) (DOOR-LEFT 0 208 :ID N3O3 :TARGET N3)
	        (DOOR-RIGHT 352 0 :ID O3P4 :TARGET P4)
	        (DOOR-RIGHT 560 224 :ID O3Q2 :KEY FLEURDELYS :TARGET Q2)
	        (RIVER 0 240 :SIZE 4)))
    (:id o5
     :location palace
     :bg-tiles ((1034 240 0) (1035 280 0) (1036 400 0)
		(1037 440 0) (1038 0 48) (1039 40 48)
		(1040 80 48) (1034 240 48) (1035 280 48)
		(1041 360 48) (1042 400 48) (1043 440 48)
		(1044 480 48) (1045 200 96) (1046 240 96)
		(1047 280 96) (1048 320 96) (1049 360 96)
		(1050 400 96) (1051 440 96) (433 480 96)
		(1052 200 144) (1053 240 144) (1054 280 144)
		(1055 320 144) (1056 360 144) (1057 600 144)
		(1058 0 192) (913 600 192) (1059 0 240)
		(1060 40 240) (1061 80 240) (1062 120 240)
		(1063 160 240) (1064 200 240) (1065 240 240)
		(1066 280 240) (1067 320 240) (1068 360 240)
		(1069 400 240) (1070 440 240) (1067 480 240)
		(1068 520 240) (1069 560 240) (1071 600 240))
     :fg-tiles ((1072 240 144) (1073 280 144) (1034 240 192) (1035 280 192))
     :elements ((GOBLET 372 32) (SHOOTINGSTAR 416 96) (MAGUS 336 224)
	        (GHOST 64 160) (DOOR-GREEN 416 32 :KEY AMPHORA)
	        (DOOR-LEFT 0 0 :ID N5O5 :TARGET N5)
	        (DOOR-RIGHT 592 32 :ID O5P5 :TARGET P5)))
    (:id o6
     :location palace
     :bg-tiles ((1074 0 0) (580 80 0) (1075 120 0)
		(1076 160 0) (1077 200 0) (1078 240 0)
		(1079 280 0) (1080 320 0) (1081 360 0)
		(1082 400 0) (1083 440 0) (1084 480 0)
		(1081 520 0) (1082 560 0) (1083 600 0)
		(1085 240 48) (1086 280 48) (1087 400 48)
		(1088 440 48) (1089 480 48) (1090 520 48)
		(1091 240 96) (1092 280 96) (1041 200 144)
		(1093 240 144) (1094 280 144) (1095 320 144)
		(1096 0 192) (1097 80 192) (1098 200 192)
		(1099 240 192) (1100 280 192) (1050 320 192)
		(1101 0 240) (1102 40 240) (1103 80 240)
		(945 120 240) (1104 160 240) (1105 200 240)
		(1034 240 240) (1035 280 240))
     :fg-tiles ((1080 480 0) (1034 240 48) (1035 280 48) (1034 240 96) (1035 280 96))
     
     :elements ((AXE 112 224) (SHOOTINGSTAR 400 96) (WILDBOAR 208 224)
	        (GHOST 352 224) (DOOR-LEFT 0 0 :ID N6O6 :TARGET N6)
	        (DOOR-RIGHT 592 48 :ID O6P6 :TARGET P6)))
    (:id p1
     :location tunnel
     :bg-tiles ((374 0 0) (1106 600 0) (1107 0 48)
		(1108 40 48) (1109 80 48) (1110 520 48)
		(1111 560 48) (1112 600 48) (1113 240 96)
		(1114 280 96) (460 600 144) (1115 0 192)
		(1116 520 192) (1117 560 192) (1118 600 192)
		(1119 0 240) (1120 40 240) (1121 80 240)
		(1122 120 240) (1123 160 240) (1124 200 240)
		(1125 240 240) (1126 280 240) (1127 320 240)
		(881 360 240) (1128 400 240) (1129 440 240)
		(1130 480 240) (1131 520 240) (1132 560 240)
		(1133 600 240))
     :fg-tiles ()
     :elements ((GOLDKEY 328 224) (MAGUS 240 224) (MAGUS 480 224)
	        (FLAIL 576 224) (FIRE 264 48) (DOOR-TRAP 576 160 :KEY GOLDKEY)
	        (DOOR-LEFT 0 0 :ID O3Q2 :TARGET O3)
	        (DOOR-LEFT 0 208 :ID O1P1 :TARGET O1)
	        (DOOR-RIGHT 592 0 :ID P1Q2 :TARGET Q2)))
    (:id p4
     :location abovecastle
     :bg-tiles ((1134 0 0) (1135 40 0) (580 80 0)
		(581 120 0) (431 160 0) (1136 200 0)
		(1137 0 48) (1138 40 48) (1139 200 48)
		(1140 600 48) (1141 160 96) (1142 200 96)
		(1143 240 96) (1144 600 96) (1145 160 144)
		(1146 200 144) (1147 240 144) (1007 560 144)
		(1148 600 144) (1149 0 192) (1150 40 192)
		(1151 160 192) (1152 200 192) (1153 240 192)
		(1154 560 192) (1155 600 192) (1156 0 240)
		(1157 40 240) (1158 120 240) (1159 160 240)
		(1160 200 240) (1161 240 240) (1162 280 240)
		(1163 320 240) (1164 360 240) (1165 400 240)
		(1160 440 240) (1166 480 240) (1160 520 240)
		(1167 560 240) (1168 600 240))
     :fg-tiles ((1169 0 0) (1170 40 0) (1171 0 192) (1172 40 192))
     :elements ((AMPHORA 256 192) (FLAIL 0 144) (MAGUS 376 192) (EYE 376 32)
	        (DOOR-LEFT 0 16 :ID P4P5 :TARGET P5)
	        (DOOR-LEFT 0 208 :ID O3P4 :TARGET O3)
	        (DOOR-RIGHT 592 0 :ID P4Q4 :TARGET Q4)))
    (:id p5
     :location palace
     :bg-tiles ((1051 120 0) (1173 160 0) (1174 200 0)
		(1175 240 0) (587 280 0) (1176 320 48)
		(1177 360 48) (1178 480 48) (1179 520 48)
		(1180 280 96) (1181 320 96) (1182 360 96)
		(1183 440 96) (1184 480 96) (1185 520 96)
		(1186 0 144) (1051 280 144) (1099 320 144)
		(1187 360 144) (1188 440 144) (1189 480 144)
		(914 0 192) (1034 320 192) (1035 360 192)
		(1190 600 192) (1191 0 240) (1192 40 240)
		(1069 80 240) (1070 120 240) (1067 160 240)
		(1068 200 240) (1069 240 240) (1070 280 240)
		(1193 320 240) (1194 360 240) (1069 400 240)
		(1070 440 240) (1067 480 240) (1068 520 240)
		(1195 560 240) (1196 600 240))
     :fg-tiles ((1197 480 0) (818 520 0) (1198 480 96)
		(1179 520 96) (1199 480 144) (1179 520 144)
		(1178 480 192) (1179 520 192) (1200 480 240)
		(1201 520 240) (1202 560 240))
     :elements ((MOON 576 32) (FLAIL 160 224) (EYE 408 192) (MAGUS 256 224)
	        (CAULDRON 32 224) (DOOR-TRAP 400 96 :KEY GOLDKEY)
	        (DOOR-LEFT 0 32 :ID O5P5 :TARGET O5)
	        (DOOR-RIGHT 512 0 :ID P5P6 :TARGET P6)
	        (DOOR-RIGHT 592 208 :ID P4P5 :TARGET P4)))
    (:id p6
     :location palace
     :bg-tiles ((1203 0 0) (1204 40 0) (1082 80 0)
		(1083 120 0) (1080 160 0) (1081 200 0)
		(1082 240 0) (1205 280 0) (1203 320 0)
		(1204 360 0) (1082 400 0) (1083 440 0)
		(1206 480 0) (1207 520 0) (1082 560 0)
		(1083 600 0) (1208 320 48) (1209 360 48)
		(842 0 96) (1210 40 96) (1211 480 96)
		(1212 520 96) (842 0 144) (1210 40 144)
		(1213 480 144) (1214 520 144) (1215 0 192)
		(1216 40 192) (1217 440 192) (1218 480 192)
		(1219 520 192) (1220 600 192) (1221 0 240)
		(1222 40 240) (1223 80 240) (1224 120 240)
		(1225 160 240) (1226 200 240) (1227 240 240)
		(1105 280 240) (1034 480 240) (1035 520 240))
     :fg-tiles ((507 0 48) (508 40 48) (1228 480 48) (1229 520 48)) 
     :elements ((MAGICWAND 192 224) (APPRENTICE 560 240) (SHOOTINGSTAR 448 96)
	        (HEAD 64 192) (GHOST 344 192)
	        (DOOR-TRAP 560 176 :KEY LITTLELYRE)
	        (DOOR-LEFT 0 48 :ID O6P6 :TARGET O6)
	        (DOOR-RIGHT 496 48 :ID P5P6 :TARGET P5)))
    (:id q2
     :location castle
     :bg-tiles ((1230 0 0) (1231 40 0) (1232 560 0)
		(1233 600 0) (1042 0 48) (945 40 48)
		(1042 80 48) (945 120 48) (1042 160 48)
		(1234 200 48) (1235 240 48) (945 280 48)
		(1042 320 48) (945 360 48) (1042 400 48)
		(945 440 48) (1042 480 48) (945 520 48)
		(1042 560 48) (945 600 48) (1236 0 96)
		(1237 40 96) (1238 80 96) (1239 120 96)
		(1240 160 96) (1241 200 96) (1242 240 96)
		(1243 280 96) (1244 320 96) (1245 360 96)
		(1246 400 96) (1247 440 96) (1248 480 96)
		(1249 520 96) (1250 560 96) (1251 600 96)
		(1252 520 144) (1253 520 192) (1254 0 240)
		(1255 40 240) (1254 80 240) (1255 120 240)
		(1254 160 240) (1255 200 240) (1254 240 240)
		(1255 280 240) (1254 320 240) (1255 360 240)
		(1254 400 240) (1255 440 240) (1256 480 240)
		(1257 520 240) (1254 560 240) (1255 600 240))
     :fg-tiles ((1258 0 0) (1259 40 0) (1260 560 0)
		(1261 600 0) (1262 120 96) (1263 160 96)
		(1264 320 96) (1265 360 96) (913 120 144)
		(1266 320 144) (913 120 192) (1266 320 192)
		(1267 120 240) (1268 160 240) (1269 320 240)
		(1270 360 240) (1271 400 240) (1272 440 240))
     :elements ((MAGICWAND 576 224) (GOLDKEY 88 32) (MAGUS 280 32)
	        (WILDBOAR 264 160) (DOOR-TRAP 224 48 :KEY GOLDKEY)
	        (DOOR-GREEN 512 208 :KEY GOLDKEY)
	        (DOOR-LEFT 0 32 :ID O3Q2 :TARGET O3)
	        (DOOR-LEFT 0 224 :ID P1Q2 :TARGET P1)
	        (DOOR-RIGHT 592 32 :ID Q2S3 :TARGET S3)))
    (:id q4
     :location abovecastle
     :bg-tiles ((1143 0 48) (1140 600 48) (1273 0 96)
		(1140 120 96) (1143 160 96) (1140 440 96)
		(1143 480 96) (1144 600 96) (1274 0 144)
		(1275 40 144) (1144 120 144) (1273 160 144)
		(1144 440 144) (1276 480 144) (1007 560 144)
		(1277 600 144) (1278 0 192) (1279 40 192)
		(1280 80 192) (1281 120 192) (1282 160 192)
		(1283 200 192) (1284 240 192) (1285 280 192)
		(1286 320 192) (1287 360 192) (1288 400 192)
		(1289 440 192) (1290 480 192) (1291 520 192)
		(1154 560 192) (1155 600 192) (1292 0 240)
		(1293 40 240) (1294 80 240) (1295 120 240)
		(1296 160 240) (1297 200 240) (1296 240 240)
		(1298 280 240) (1299 320 240) (1300 360 240)
		(1161 400 240) (1301 440 240) (1161 480 240)
		(1302 520 240) (1303 560 240) (1168 600 240))
     :fg-tiles ()
     :elements ((SPELLBOOK 64 192) (SHOOTINGSTAR 544 48) (GHOST 256 96)
	        (MAGUS 208 160) (APPRENTICE 336 224)
	        (DOOR-TRAP 336 176 :KEY SPELLBOOK)
	        (DOOR-LEFT 0 0 :ID P4Q4 :TARGET P4)
	        (DOOR-LEFT 288 224 :ID Q4S2 :KEY FLEURDELYS :TARGET S2)
	        (DOOR-RIGHT 592 0 :ID Q4R4 :TARGET R4)))
    (:id r4
     :location abovecastle
     :bg-tiles ((1304 0 0) (1305 40 0) (1051 120 0)
		(1306 160 0) (1307 200 0) (997 240 0)
		(1308 0 48) (1309 40 48) (1139 360 48)
		(1310 0 96) (1141 320 96) (1311 360 96)
		(1143 400 96) (1312 0 144) (1313 40 144)
		(1145 320 144) (1314 360 144) (1147 400 144)
		(1180 520 144) (1315 560 144) (1316 600 144)
		(1278 0 192) (1279 40 192) (1151 320 192)
		(1152 360 192) (1153 400 192) (1051 520 192)
		(1317 560 192) (1318 600 192) (1292 0 240)
		(1293 40 240) (1319 80 240) (1320 120 240)
		(1296 160 240) (1301 200 240) (1321 240 240)
		(1322 280 240) (1296 320 240) (1323 360 240)
		(1324 400 240) (1325 440 240) (1326 480 240)
		(1327 520 240) (1328 560 240) (1329 600 240))
     :fg-tiles ()
     :elements ((AMPHORA 64 192) (SWORD 416 192) (MAGUS 240 192) (EYE 512 32)
	        (DOOR-LEFT 16 0 :ID Q4R4 :TARGET Q4)
	        (DOOR-RIGHT 576 208 :ID R4S3 :TARGET S3)))
    (:id s2
     :location castle
     :bg-tiles ((1264 0 0) (1265 40 0) (1246 80 0)
		(1247 120 0) (1330 160 0) (1244 200 0)
		(1250 240 0) (1251 280 0) (1331 320 0)
		(1332 360 0) (1333 400 0) (1334 440 0)
		(1335 480 0) (1336 520 0) (1337 560 0)
		(1338 600 0) (1339 0 48) (1340 0 96)
		(1341 40 96) (1340 80 96) (1341 120 96)
		(1340 160 96) (1341 200 96) (1342 240 96)
		(1343 280 96) (1344 320 96) (1345 360 96)
		(1346 400 96) (1347 440 96) (1340 480 96)
		(1348 520 96) (1349 560 96) (1341 600 96)
		(1350 280 192) (1351 320 192) (466 360 192)
		(1352 400 192) (1353 440 192) (1354 480 192)
		(1355 520 192) (1111 560 192) (1356 600 192)
		(1254 0 240) (1255 40 240) (1254 80 240)
		(1255 120 240) (1254 160 240) (1255 200 240)
		(1254 240 240) (1255 280 240) (1357 320 240)
		(1358 360 240) (1359 400 240) (1360 440 240)
		(1359 480 240) (1360 520 240) (1359 560 240)
		(1360 600 240))
     :fg-tiles ((1248 160 0) (1249 200 0) (1361 360 0)
		(1362 400 0) (1363 560 0) (1364 600 0)
		(1365 200 48) (1366 400 48) (1367 560 48)
		(1368 600 48) (1369 160 96) (1370 200 96)
		(1371 360 96) (1372 400 96) (1373 560 96)
		(1374 320 192) (1375 360 192) (1376 400 192)
		(1377 440 192) (1378 480 192) (1379 520 192)
		(1380 560 192) (1381 320 240) (1382 360 240)
		(1383 400 240) (1384 440 240) (1385 480 240)
		(1386 520 240) (1383 560 240))
     :elements ((AMPHORA 576 144) (GOLDKEY 440 64) (MAGUS 360 64)
	        (MAGUS 200 224) (DOOR-TRAP 288 80 :KEY GOLDKEY)
	        (DOOR-GREEN 272 224 :KEY GOLDENCHALICE)
	        (DOOR-LEFT 0 64 :ID Q2S3 :TARGET Q2)
	        (DOOR-RIGHT 592 64 :ID Q4S2 :TARGET Q4)
	        (DOOR-RIGHT 592 224 :ID S2U2 :TARGET U2)))

    (:id s3
     :location nearcastle
     :bg-tiles ((1387 0 0) (1388 40 0) (1389 80 0)
		(1390 120 0) (1391 160 0) (580 320 0)
		(1392 360 0) (1393 400 0) (1394 0 48)
		(1395 40 48) (1051 120 48) (1396 160 48)
		(1397 200 48) (1398 240 48) (1399 0 96)
		(1400 40 96) (1143 80 96) (1401 560 96)
		(1402 0 144) (1403 40 144) (1404 80 144)
		(1405 520 144) (1406 560 144) (1407 600 144)
		(1408 0 192) (1409 40 192) (1017 200 192)
		(1410 240 192) (1411 280 192) (1412 520 192)
		(1413 560 192) (1414 600 192) (1415 0 240)
		(1416 40 240) (1417 80 240) (1418 120 240)
		(1419 160 240) (1420 200 240) (1421 240 240)
		(1422 280 240) (1423 320 240) (1424 360 240)
		(1024 400 240) (1425 440 240) (24 480 240)
		(1426 520 240) (1427 560 240) (1428 600 240))
     :fg-tiles ((1429 160 192) (1430 200 192) (1431 240 192)
		(1432 280 192) (1433 320 192)
		(1434 320 240))
     :elements ((GOLDENCHALICE 272 176) (AXE 384 224) (GHOST 512 32)
	        (HEAD 336 128) (DOOR-LEFT 176 0 :ID R4S3 :TARGET R4)
	        (DOOR-LEFT 32 208 :ID Q2S3 :KEY FLEURDELYS :TARGET Q2)
	        (DOOR-RIGHT 592 224 :ID S3T3 :TARGET T3)))

    (:id t3
     :location woods
     :bg-tiles ((819 600 0) (239 80 48) (580 560 48)
		(1435 600 48) (1436 40 96) (1437 80 96)
		(1438 120 96) (1439 240 96) (1440 280 96)
		(436 320 96) (437 360 96) (1441 0 144)
		(1442 40 144) (1443 80 144) (1444 120 144)
		(1445 160 144) (1446 200 144) (1447 240 144)
		(1448 280 144) (1449 320 144) (902 360 144)
		(1450 0 192) (1451 40 192) (1452 320 192)
		(171 360 192) (1405 600 192) (1453 0 240)
		(35 40 240) (1454 80 240) (1455 120 240)
		(1456 160 240) (1457 200 240) (1458 240 240)
		(1459 280 240) (1460 320 240) (1461 360 240)
		(1462 480 240) (1463 520 240) (1464 560 240)
		(1465 600 240))
     :fg-tiles ()
     :elements ((FLEURDELYS 528 208) (CAULDRON 192 112) (SHOOTINGSTAR 560 52)
	        (HEAD 128 48) (EYE 512 128) (DOOR-GREEN 320 208 :KEY AMPHORA)
	        (DOOR-LEFT 0 224 :ID S3T3 :TARGET S3)
	        (DOOR-RIGHT 592 0 :ID T3U3 :TARGET U3) (RIVER 384 240 :SIZE 4)))

    (:id u2
     :location castle
     :bg-tiles ((1236 0 0) (1237 40 0) (1238 80 0)
		(1239 120 0) (1240 160 0) (1466 200 0)
		(1467 240 0) (1243 280 0) (1244 320 0)
		(1245 360 0) (1246 400 0) (1468 440 0)
		(1153 480 0) (1469 600 0) (1470 440 48)
		(1153 480 48) (1471 560 48) (1472 600 48)
		(1473 0 96) (1474 40 96) (1475 80 96)
		(1355 120 96) (1476 160 96) (191 200 96)
		(1470 440 96) (1153 480 96) (1470 440 144)
		(1153 480 144) (1477 0 192) (1112 40 192)
		(1478 80 192) (1479 120 192) (1111 160 192)
		(1112 200 192) (1480 240 192) (1470 440 192)
		(1153 480 192) (1254 0 240) (1255 40 240)
		(1254 80 240) (1255 120 240) (1254 160 240)
		(1255 200 240) (1254 240 240) (1481 280 240)
		(683 320 240) (503 360 240) (571 400 240)
		(1482 440 240) (1483 480 240) (1484 520 240)
		(243 560 240) (1485 600 240))
     :fg-tiles ((1262 120 0) (1263 160 0) (1264 320 0)
		(1265 360 0) (1486 120 48) (1487 160 48)
		(1339 320 48) (427 160 144) (1488 40 192)
		(1489 80 192) (1490 120 192) (1491 160 192)
		(1492 200 192) (1493 40 240) (1494 80 240)
		(1495 120 240) (1496 160 240) (1497 200 240)
		(1498 400 240) (1499 440 240))
     :elements ((FLAIL 512 224) (HEAD 552 128) (GHOST 372 128) (APPRENTICE 128 224)
	        (SPELLBAG 192 144) (CAULDRON 352 224)
	        (DOOR-GREEN 224 224 :KEY AMPHORA)
	        (DOOR-LEFT 0 48 :ID Q4S2 :TARGET S2)
	        (DOOR-LEFT 0 224 :ID S2U2 :TARGET S2)
	        (DOOR-RIGHT 592 0 :ID U2V3 :TARGET V3)))
    (:id u3
     :location nearvillage
     :bg-tiles ((898 0 0) (1500 160 0) (1501 200 0)
		(1502 240 0) (1503 280 0) (433 320 0)
		(1504 0 48) (587 40 48) (926 520 48)
		(1505 560 48) (1506 600 48) (1401 0 144)
		(1507 560 144) (1508 600 144) (1406 0 192)
		(1407 40 192) (1509 560 192) (1510 600 192)
		(1511 0 240) (1512 40 240) (1513 80 240)
		(1514 120 240) (1515 160 240) (1516 200 240)
		(1517 240 240) (1021 280 240) (1518 320 240)
		(1519 360 240) (24 400 240) (1520 440 240)
		(1521 480 240) (1514 520 240) (1522 560 240) (1523 600 240))
     :fg-tiles ()
     :elements ((SWORD 224 224)
	        (AMPHORA 320 224)
	        (MAGUS 96 224)
	        (HEAD 416 8)
	        (DOOR-LEFT 0 0 :ID T3U3 :TARGET T3)
	        (DOOR-RIGHT 592 0 :ID U3V3 :TARGET V3)))
    (:id v3
     :location nearvillage
     :bg-tiles ((1524 440 0) (1525 480 0) (1526 520 0)
		(1527 560 0) (1528 600 0) (1529 0 48)
		(1530 40 48) (1531 80 48) (1532 0 96)
		(1533 0 144) (1534 40 144) (1535 200 144)
		(1536 240 144) (1537 280 144) (1538 560 144)
		(1539 600 144) (1540 0 192) (1541 40 192)
		(1542 80 192) (1543 160 192) (1544 200 192)
		(1545 240 192) (1546 280 192) (1547 520 192)
		(1548 560 192) (1549 600 192) (1550 0 240)
		(1551 40 240) (1454 80 240) (1552 120 240)
		(1553 160 240) (1554 200 240) (1555 240 240)
		(1556 280 240) (1557 320 240) (1558 360 240)
		(1559 400 240) (1560 440 240) (1561 480 240)
		(1562 520 240) (1563 560 240) (1564 600 240))
     :fg-tiles ()
     :elements ((SHOOTINGSTAR 544 32) (FLAIL 496 208) (MAGUS 372 224)
	        (HEAD 256 8) (DOOR-LEFT 0 0 :ID U3V3 :TARGET U3)
	        (DOOR-LEFT 32 224 :ID U2V3 :TARGET U2)))))

(defvar *player-positions*
  `((T3 305 5) (U2 510 18) (U3 323 39) (V3 409 26) (E1 306 11) (F1 293 15)
    (G1 292 15) (G2 309 12) (H1 228 22) (H2 300 76) (I2 180 46) (J1 374 15)
    (J3 374 15) (K3 362 40) (L3 362 40) (M3 362 40) (N3 225 143) (N5 299 78)
    (N6 418 16) (O3 441 83) (O5 515 29) (O6 153 48) (P4 105 36) (P6 158 40)
    (R4 276 37) (S3 371 44)))

(defun player-position-at (area-name)
    (rest (assoc area-name *player-positions*)))

(defvar *sanctuary-apprentices-positions*
  #(#(16 210) #(560 210) #(80 178) #(496 178)
    #(144 146) #(432 146) #(208 114) #(368 114)))

(defun sanctuary-apprentice-pos (index)
  (aref *sanctuary-apprentices-positions* (1- index)))
